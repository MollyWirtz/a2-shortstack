<!doctype html>
<html lang="en">

<head>
  <title>CS4241 Assignment 2</title>
  <meta charset="utf-8">
</head>

<body>
  <h1>Bill Tracker</h1>
  <h3>Enter your bill:</h3>
  <form name="billForm" action="">
    <input type="text" id="name" value="Bill name">
    <input type="number" id="amt" value="0.00">
    <input type="date" id="date">
    <input type="checkbox" id="paid" value="true">
    <label for="paid">Paid?</label>
    <button>submit</button>
  </form>

  <!-- Results functionality to show entire dataset -->
  <br>
  <button onClick="getAllBills()">Show all bills</button>
  <br>
  Select an entry to modify
  <div>
    <table id="all_bills">
      <tr>
        <th>Name</th>
        <th>Amount</th>
        <th>Date Issued</th>
        <th>Paid</th>
      </tr>
    </table>
  </div>
</body>
<script>
  const submit = function (e) {
    // prevent default form action from being carried out
    e.preventDefault()

    var computePaid = document.getElementById("paid").checked;

    const input = document.querySelector('billForm'),
      json = {
        billName: document.querySelector('#name').value,
        billAmt: document.querySelector('#amt').value,
        billDate: document.querySelector('#date').value,
        billPay: computePaid
      },

      body = JSON.stringify(json)

    fetch('/submit', {
        method: 'POST',
        body
      })
      .then(function (response) {
        // do something with the reponse 
        console.log(response)
      })
    return false
  }

  window.onload = function () {
    const button = document.querySelector('button')
    button.onclick = submit
  }

  // 
  function getAllBills() {
    // let billDiv = document.getElementById('all_bills')
    const response = fetch('/results', {
        method: 'GET'
      })
      .then(response => response.json())
      .then(function (data) {
        console.log(data)
        displayBills(data)
      })
  }

  function displayBills(jsonArray) {
    let billDiv = document.getElementById('all_bills')

    // TODO: Clear table and repopulate


    for (obj in jsonArray){
      var newRow = document.createElement('tr')
      newRow.innerHTML = 
      `<td>${jsonArray[obj].billName}</td>
      <td>${jsonArray[obj].billAmt}</td>
      <td>${jsonArray[obj].billDate}</td>
      <td>${jsonArray[obj].billPay}</td>`
      billDiv.appendChild(newRow)
    }
  }
</script>

</html>